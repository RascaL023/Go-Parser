#!/usr/bin/env bash

# ===============================
# Script helper untuk build/run Go
# ===============================

# Paths
BINARY="bin/renderer"
SRC="./cmd/renderer"
OPTION=$2
NAME=$3

# Function: print usage
usage() {
    echo "Usage: $0 [option]"
    echo "Options:"
    echo "  build   [theme|waybar]    -> Build binary"
    echo "  run     [theme|waybar]    -> Build + run binary"
    echo "  run-bin [theme|waybar]    -> Run binary only"
    echo "  go-run  [theme|waybar]    -> Run without build"
    echo "  clean   [theme|waybar]    -> Remove binary"    
    exit 1
}

# Ensure bin folder exists
mkdir -p bin

# Check argument
if [ $# -eq 0 ]; then
    usage
fi

case "$1" in
    build)
        echo "[+] Building binary..."
        go build -o "$BINARY" "$SRC"
        echo "[+] Done: $BINARY"
        ;;
    run)
        echo "[+] Building binary..."
        go build -o "$BINARY" "$SRC"
        echo "[+] Running binary..."
        "./$BINARY" "$OPTION" "$NAME"
        ;;
    go-run)
        echo "[+] Running without build..."
        go run "$SRC" "$OPTION" "$NAME"
        ;;
    clean)
        echo "[+] Removing binary..."
        rm -f "$BINARY"
        ;;
    run-bin)
        echo "[+] Running binary..."
        "./$BINARY" "$OPTION" "$NAME"
        ;;
    waybar-run)
        echo "[+] Running waybar without build..."
        OPTION="waybar"
        go run "$SRC" "$OPTION" "$NAME"
        ;;
    *)
        usage
        ;;
esac

